<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Refeit√≥rio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4757;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #2ed573;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .connect-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 30px;
            transition: transform 0.2s;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
        }

        .connect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }

        .card-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #fff;
        }

        .card-label {
            font-size: 14px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sensor-card {
            grid-column: 1 / -1;
            background: rgba(255,255,255,0.1);
        }

        .log {
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff;
        }

        .log-entry {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s;
        }

        .reset-btn:hover {
            transform: translateY(-1px);
        }

        .error-msg {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Dashboard Refeit√≥rio</h1>
        </div>

        <div class="status">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Desconectado</span>
        </div>

        <button class="connect-btn" id="connectBtn" onclick="connectBluetooth()">
            üì± Conectar Bluetooth
        </button>

        <div id="errorMsg" class="error-msg" style="display: none;"></div>

        <div class="dashboard">
            <div class="card">
                <span class="card-icon">üë•</span>
                <div class="card-value" id="alunoCount">0</div>
                <div class="card-label">Alunos</div>
            </div>

            <div class="card">
                <span class="card-icon">ü•§</span>
                <div class="card-value" id="bebidaCount">0</div>
                <div class="card-label">Bebidas</div>
            </div>

            <div class="card">
                <span class="card-icon">üçΩÔ∏è</span>
                <div class="card-value" id="comidaCount">0</div>
                <div class="card-label">Comidas</div>
            </div>

            <div class="card sensor-card">
                <span class="card-icon">üìè</span>
                <div class="card-value" id="sensorValue">0 cm</div>
                <div class="card-label">Dist√¢ncia Sensor</div>
            </div>
        </div>

        <button class="reset-btn" onclick="resetCounters()">
            üîÑ Resetar Contadores
        </button>

        <div class="log">
            <div class="log-title">üìä Log de Dados</div>
            <div id="logContainer"></div>
        </div>
    </div>

    <script>
        let bluetoothDevice = null;
        let characteristic = null;
        let isConnected = false;

        // Dados do dashboard
        let dados = {
            sensor: 0,
            bebida: 0,
            comida: 0,
            aluno: 0
        };

        // Elementos DOM
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const connectBtn = document.getElementById('connectBtn');
        const errorMsg = document.getElementById('errorMsg');
        const logContainer = document.getElementById('logContainer');

        // Fun√ß√£o para conectar via Bluetooth
        async function connectBluetooth() {
            try {
                hideError();
                connectBtn.disabled = true;
                connectBtn.textContent = 'üîÑ Conectando...';

                // Verifica se o navegador suporta Web Bluetooth
                if (!navigator.bluetooth) {
                    throw new Error('Bluetooth n√£o suportado neste navegador. Use Chrome no Android.');
                }

                // Solicita dispositivo Bluetooth
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    filters: [
                        { name: 'HC-05' },
                        { namePrefix: 'HC-' }
                    ],
                    optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e'] // Nordic UART Service
                });

                // Conecta ao dispositivo
                const server = await bluetoothDevice.gatt.connect();
                const service = await server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
                characteristic = await service.getCharacteristic('6e400003-b5a3-f393-e0a9-e50e24dcca9e');

                // Inicia notifica√ß√µes
                await characteristic.startNotifications();
                characteristic.addEventListener('characteristicvaluechanged', handleData);

                // Atualiza status
                updateConnectionStatus(true);
                addLog('‚úÖ Conectado ao Arduino via Bluetooth');

                // Listener para desconex√£o
                bluetoothDevice.addEventListener('gattserverdisconnected', () => {
                    updateConnectionStatus(false);
                    addLog('‚ùå Dispositivo desconectado');
                });

            } catch (error) {
                console.error('Erro na conex√£o:', error);
                showError('Erro: ' + error.message);
                updateConnectionStatus(false);
            }
        }

        // Processa dados recebidos do Arduino
        function handleData(event) {
            try {
                const value = new TextDecoder().decode(event.target.value);
                addLog('üì° Recebido: ' + value);

                // Parse do JSON
                const data = JSON.parse(value);
                
                // Atualiza dados
                dados.sensor = data.sensor || 0;
                dados.bebida = data.bebida || 0;
                dados.comida = data.comida || 0;
                dados.aluno = data.aluno || 0;

                // Atualiza interface
                updateDashboard();
                
            } catch (error) {
                console.error('Erro ao processar dados:', error);
                addLog('‚ö†Ô∏è Erro ao processar: ' + error.message);
            }
        }

        // Atualiza o dashboard com os novos dados
        function updateDashboard() {
            document.getElementById('alunoCount').textContent = dados.aluno;
            document.getElementById('bebidaCount').textContent = dados.bebida;
            document.getElementById('comidaCount').textContent = dados.comida;
            document.getElementById('sensorValue').textContent = dados.sensor + ' cm';

            // Adiciona anima√ß√£o nos valores que mudaram
            animateValue('alunoCount');
            animateValue('bebidaCount');
            animateValue('comidaCount');
            animateValue('sensorValue');
        }

        // Anima√ß√£o simples para valores atualizados
        function animateValue(elementId) {
            const element = document.getElementById(elementId);
            element.style.transform = 'scale(1.1)';
            element.style.transition = 'transform 0.2s';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }

        // Atualiza status da conex√£o
        function updateConnectionStatus(connected) {
            isConnected = connected;
            
            if (connected) {
                statusDot.classList.add('connected');
                statusText.textContent = 'Conectado';
                connectBtn.textContent = '‚úÖ Conectado';
                connectBtn.disabled = true;
            } else {
                statusDot.classList.remove('connected');
                statusText.textContent = 'Desconectado';
                connectBtn.textContent = 'üì± Conectar Bluetooth';
                connectBtn.disabled = false;
            }
        }

        // Adiciona entrada no log
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = `${timestamp} - ${message}`;
            
            logContainer.insertBefore(logEntry, logContainer.firstChild);
            
            // Mant√©m apenas as √∫ltimas 20 entradas
            while (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // Mostra mensagem de erro
        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
            setTimeout(hideError, 5000);
        }

        // Esconde mensagem de erro
        function hideError() {
            errorMsg.style.display = 'none';
        }

        // Reset dos contadores (apenas visual)
        function resetCounters() {
            dados = { sensor: 0, bebida: 0, comida: 0, aluno: 0 };
            updateDashboard();
            addLog('üîÑ Contadores resetados (apenas visual)');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            addLog('üì± App iniciado - Pronto para conectar');
            updateDashboard();
        });

        // Simula dados para teste (remover em produ√ß√£o)
        function simulateData() {
            if (!isConnected) {
                const testData = {
                    sensor: Math.floor(Math.random() * 30),
                    bebida: Math.floor(Math.random() * 10),
                    comida: Math.floor(Math.random() * 15),
                    aluno: Math.floor(Math.random() * 25)
                };
                
                dados = testData;
                updateDashboard();
                addLog('üß™ Dados simulados para teste');
            }
        }

        // Bot√£o de teste (remover em produ√ß√£o)
        setTimeout(() => {
            if (!isConnected) {
                const testBtn = document.createElement('button');
                testBtn.textContent = 'üß™ Simular Dados (Teste)';
                testBtn.className = 'reset-btn';
                testBtn.style.background = 'linear-gradient(45deg, #ffa726 0%, #ff9800 100%)';
                testBtn.onclick = simulateData;
                document.querySelector('.container').appendChild(testBtn);
            }
        }, 3000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983cdb09e5786e30',t:'MTc1ODY2MDAxMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
